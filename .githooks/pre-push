#!/usr/bin/env bash
set -e
echo "Starting test database..."
docker compose -p p8-test -f docker-compose.test.yml up -d --wait
trap 'docker compose -p p8-test -f docker-compose.test.yml down' EXIT
echo "Running migrations..."
P8_DATABASE_URL=postgresql://p8:p8_dev@localhost:5499/p8 uv run p8 migrate
echo "Running integration tests..."
uv run pytest tests/integration/ -x -q
